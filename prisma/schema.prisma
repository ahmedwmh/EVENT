// Prisma Schema for Event Registration - Optimized for Speed & Security

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  // For Supabase, use the same DATABASE_URL for directUrl if DIRECT_URL is not set
  directUrl = env("DIRECT_URL")
}

model Registration {
  id               String   @id @default(uuid())
  name             String   @db.VarChar(100)
  phoneNumber      String   @unique @map("phone_number") @db.VarChar(20)
  city             String   @db.VarChar(100)
  message          String?  @db.Text
  // New fields for family members
  firstPersonName  String   @map("first_person_name") @db.VarChar(100)
  secondPersonName String?  @map("second_person_name") @db.VarChar(100)
  // Admin-only fields
  invitationSent   Boolean  @default(false) @map("invitation_sent")
  familyAccepted   Boolean  @default(false) @map("family_accepted")
  notes            String?  @db.Text
  attended         Boolean  @default(false)
  otpCode          String?  @map("otp_code") @db.VarChar(10)
  invitationCode   String?  @unique @map("invitation_code") @db.VarChar(20)
  qrCodeScanned    Boolean  @default(false) @map("qr_code_scanned")
  qrCodeScannedAt  DateTime? @map("qr_code_scanned_at")
  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  // Indexes for fast queries
  @@index([phoneNumber], name: "idx_registrations_phone")
  @@index([city], name: "idx_registrations_city")
  @@index([createdAt(sort: Desc)], name: "idx_registrations_created_at")
  @@index([updatedAt(sort: Desc)], name: "idx_registrations_updated_at")
  @@index([invitationSent], name: "idx_registrations_invitation_sent")
  @@index([familyAccepted], name: "idx_registrations_family_accepted")
  @@index([attended], name: "idx_registrations_attended")
  @@index([invitationCode], name: "idx_registrations_invitation_code")
  @@index([qrCodeScanned], name: "idx_registrations_qr_scanned")
  // Composite index for common queries
  @@index([city, createdAt(sort: Desc)], name: "idx_registrations_city_created")
  @@map("registrations")
}

model Admin {
  id        String   @id @default(uuid())
  username  String   @unique @db.VarChar(50)
  password  String   @db.VarChar(255) // Hashed password
  email     String?  @unique @db.VarChar(255)
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Indexes for fast queries
  @@index([username], name: "idx_admins_username")
  @@index([email], name: "idx_admins_email")
  @@index([isActive], name: "idx_admins_is_active")
  @@index([createdAt(sort: Desc)], name: "idx_admins_created_at")
  @@map("admins")
}

model Settings {
  id                    String   @id @default(uuid())
  registrationSuccessMessage String   @default("Ù…Ø±Ø­Ø¨Ø§Ù‹ {name} ğŸ‘‹\n\nØªÙ… Ø§Ø³ØªÙ„Ø§Ù… ØªØ³Ø¬ÙŠÙ„Ùƒ ÙÙŠ ØªØ¬Ù…Ø¹ Ø§Ù„ÙÙ†Ø§Ù†ÙŠÙ† Ø¨Ù†Ø¬Ø§Ø­! âœ…\n\nğŸ“ Ø§Ù„Ù…Ø¯ÙŠÙ†Ø©: {city}\nğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¯Ø«: {eventDate}\n\nÙ†Ø­Ù† Ø³Ø¹Ø¯Ø§Ø¡ Ø¨Ø§Ù†Ø¶Ù…Ø§Ù…Ùƒ Ø¥Ù„ÙŠÙ†Ø§. Ø³ÙŠØªÙ… Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹Ùƒ Ù‚Ø±ÙŠØ¨Ø§Ù‹ Ø¹Ø¨Ø± Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ Ø§Ù„Ù…Ù‚Ø¯Ù… Ù„Ù„ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ©.\n\nØ´ÙƒØ±Ø§Ù‹ Ù„Ø§Ù‡ØªÙ…Ø§Ù…Ùƒ! ğŸ™\n\nÂ© 2025 ØªØ¬Ù…Ø¹ Ø§Ù„ÙÙ†Ø§Ù†ÙŠÙ†") @map("registration_success_message") @db.Text
  invitationMessage     String   @default("Ù…Ø±Ø­Ø¨Ø§Ù‹ {name} ğŸ‘‹\n\nÙ†Ø­Ù† Ø³Ø¹Ø¯Ø§Ø¡ Ø¨Ø¯Ø¹ÙˆØªÙƒ Ù„Ø­Ø¶ÙˆØ± ØªØ¬Ù…Ø¹ Ø§Ù„ÙÙ†Ø§Ù†ÙŠÙ†! ğŸ‰\n\nğŸ“… ØªØ§Ø±ÙŠØ® Ø§Ù„Ø­Ø¯Ø«: {eventDate}\n\nÙ†Ø­Ù† ÙÙŠ Ø§Ù†ØªØ¸Ø§Ø±Ùƒ! ğŸ™\n\nÂ© 2025 ØªØ¬Ù…Ø¹ Ø§Ù„ÙÙ†Ø§Ù†ÙŠÙ†") @map("invitation_message") @db.Text
  createdAt             DateTime @default(now()) @map("created_at")
  updatedAt             DateTime @updatedAt @map("updated_at")

  @@map("settings")
}
